<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#667eea"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</title>
<link rel="manifest" href="manifest.json">
<style>
/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) --- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: 'Arial','Segoe UI',sans-serif;
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    margin:0;padding:20px;min-height:100vh;line-height:1.6;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}

/* --- Ø¨Ø§Ù†Ø± ØªØ±Ø­ÙŠØ¨ÙŠ Ù…ØªØ­Ø±Ùƒ Ù…Ø¹ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ --- */
.welcome-wrap {
    text-align: center;
    margin-bottom: 16px;
}
.welcome-banner {
    display: inline-block;
    padding: 10px 18px;
    border-radius: 12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    color: #fff;
    font-weight: 700;
    font-size: 18px;
    letter-spacing: 1px;
    text-shadow: 0 0 6px rgba(255,255,255,0.85);
    animation: bannerGlow 3s ease-in-out infinite alternate, bannerFloat 6s ease-in-out infinite;
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    border: 1px solid rgba(255,255,255,0.08);
}
@keyframes bannerGlow {
    from { text-shadow: 0 0 6px rgba(255,255,255,0.6), 0 0 10px rgba(255,215,0,0.3); transform: translateZ(0) scale(1); }
    to   { text-shadow: 0 0 18px rgba(255,255,255,0.9), 0 0 26px rgba(255,140,0,0.25); transform: translateZ(0) scale(1.02); }
}
@keyframes bannerFloat {
    0% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0); }
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ØªØ­Øª Ø§Ù„Ø¨Ø§Ù†Ø± */
.welcome-phones {
    margin-top: 8px;
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    font-size:14px;
    color:#fff;
    opacity:0.95;
}
.phone-pill {
    display:inline-flex;
    align-items:center;
    gap:8px;
    background: rgba(0,0,0,0.15);
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.06);
    backdrop-filter: blur(4px);
    animation: phonePulse 2.5s ease-in-out infinite;
}
@keyframes phonePulse {
    0% { transform: translateY(0); opacity:0.95; }
    50% { transform: translateY(-3px); opacity:1; }
    100% { transform: translateY(0); opacity:0.95; }
}
.phone-pill a { color: #fff; text-decoration: none; font-weight:700; }

/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‡Ø§ØªÙ ØµØºÙŠØ±Ø© */
.phone-icon {
    width:18px;height:18px;display:inline-block;vertical-align:middle;
}

/* --- Ø¨Ø§Ù‚ÙŠ ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©) --- */
.container {
    max-width:880px;margin:0 auto;background:#fff;padding:34px;border-radius:20px;
    box-shadow:0 18px 45px rgba(0,0,0,0.32);
}
h1{color:#2c3e50;text-align:center;margin-bottom:8px;font-size:30px}
.subtitle{text-align:center;color:#7f8c8d;margin-bottom:18px;font-size:15px}

.section-title{color:#2c3e50;margin:18px 0 12px 0;padding-bottom:8px;border-bottom:2px solid #ecf0f1;font-size:18px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px}
.form-group{margin-bottom:12px}
label{display:block;margin-bottom:6px;font-weight:700;color:#34495e;font-size:14px}
input,select{width:100%;padding:10px;border:2px solid #bdc3c7;border-radius:8px;font-size:14px;background:#f8f9fa;transition:all .2s}
input:focus,select:focus{border-color:#3498db;outline:none;background:#fff;box-shadow:0 0 0 4px rgba(52,152,219,0.06)}

.buttons-group{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin:18px 0}
button{color:#fff;padding:12px;border:none;border-radius:10px;font-size:15px;font-weight:800;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px}
.calculate-btn{background:linear-gradient(135deg,#27ae60,#2ecc71)}
.reset-btn{background:linear-gradient(135deg,#e74c3c,#c0392b)}
.print-btn{background:linear-gradient(135deg,#34495e,#2c3e50)}
button:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,0.12)}

.result{margin-top:18px;padding:18px;background:linear-gradient(135deg,#ecf0f1,#dfe6e9);border-radius:12px;text-align:center;display:none;border:3px solid #3498db}
.calculation-info{background:#fff;padding:14px;border-radius:8px;margin:10px 0;text-align:right;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.billet-result{font-size:26px;color:#e74c3c;font-weight:900;margin:14px 0;padding:14px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.calculation-steps{background:#fff;padding:14px;border-radius:8px;margin:12px 0;text-align:right;font-size:14px;line-height:1.6;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.step{margin:8px 0;padding:10px;background:#f8f9fa;border-radius:6px;border-right:4px solid #3498db}

.summary{margin-top:12px;text-align:right;background:#fff;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.04);font-size:14px}

.analysis-table{margin-top:12px;width:100%;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.04);border:1px solid #d0e6ff}
.analysis-table table{width:100%;border-collapse:collapse;direction:rtl}
.analysis-table th,.analysis-table td{padding:10px 12px;text-align:right;font-size:14px;border-bottom:1px solid #eef6ff}
.analysis-table thead{background:linear-gradient(90deg,#e6f2ff,#f7fbff);color:#114b8a;font-weight:700}
.analysis-table .highlight{font-weight:900;color:#e74c3c}

.whatsapp-row {
    margin-top:18px;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
}

/* Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
.whatsapp-btn {
    display:inline-flex;
    align-items:center;
    gap:10px;
    background:#25D366;
    color:white;
    padding:10px 14px;
    border-radius:999px;
    text-decoration:none;
    font-weight:800;
    box-shadow:0 8px 20px rgba(37,211,102,0.18);
    border: 2px solid rgba(0,0,0,0.03);
}
.whatsapp-btn svg { width:20px; height:20px; }

/* Ù…Ù„Ø§Ø­Ø¸Ø© ØµØºÙŠØ±Ø© Ø£Ø³ÙÙ„ Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
.whatsapp-note { font-size:13px; color:#6b7280; margin-top:6px; text-align:center; }

/* Ø£Ø²Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ */
.mold-management {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    border: 2px solid #e9ecef;
}
.mold-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
}
.mold-btn {
    padding: 10px;
    font-size: 14px;
    border-radius: 8px;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}
.mold-save { background: #27ae60; }
.mold-search { background: #3498db; }
.mold-show { background: #9b59b6; }
.mold-delete { background: #e74c3c; }
.mold-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

.small { font-size: 12px; color: #7f8c8d; margin-top: 5px; }

/* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
.auto-fill-indicator {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #3498db;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 5px;
    vertical-align: middle;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.auto-fill-notice {
    background: #e8f4fd;
    border: 1px solid #b6e0fe;
    border-radius: 6px;
    padding: 8px 12px;
    margin: 8px 0;
    font-size: 13px;
    color: #1e6fa8;
    display: none;
}

/* Ù‚Ø³Ù… Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ */
.bed-length-result {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    padding: 16px;
    border-radius: 10px;
    margin: 16px 0;
    border: 2px solid #90caf9;
    text-align: center;
}
.bed-length-title {
    font-size: 20px;
    font-weight: 900;
    color: #1565c0;
    margin-bottom: 12px;
}
.bed-length-value {
    font-size: 24px;
    font-weight: 900;
    color: #e65100;
    margin: 8px 0;
}
.bed-length-details {
    background: #fff;
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    font-size: 14px;
    text-align: right;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.bed-length-step {
    margin: 6px 0;
    padding: 8px;
    background: #f3f9ff;
    border-radius: 6px;
    border-right: 3px solid #42a5f5;
}

/* Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª */
.install-btn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #e74c3c;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
}

@media(max-width:900px){ 
    .form-grid,.buttons-group{grid-template-columns:1fr} 
    .container{padding:18px} 
    h1{font-size:22px} 
    .mold-buttons { grid-template-columns: 1fr 1fr; }
    .bed-length-value { font-size: 20px; }
}
</style>
</head>
<body>

<!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<button class="install-btn" id="installButton">ğŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

<!-- Ø¨Ø§Ù†Ø± + Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
<div class="welcome-wrap">
    <div class="welcome-banner">âœ§ï½¥ï¾Ÿ: *âœ¿ Ù…Ù‚Ø¯Ù…Ø© Ø¥Ù„ÙŠÙƒÙ… Ùˆ Ø£Ù‡Ø¯Ø§Ø¡ Ù…Ù† ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² FAHD ABD ELAZIZ âœ¿* :ï½¥ï¾Ÿâœ§</div>

    <div class="welcome-phones" aria-hidden="false">
        <div class="phone-pill" title="Ø§ØªØµØ§Ù„">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‡Ø§ØªÙ Ø¨Ø³ÙŠØ·Ø© (SVG) -->
            <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
            </svg>
            <a href="tel:01124006047">01124006047</a>
        </div>

        <div class="phone-pill" title="Ø§ØªØµØ§Ù„">
            <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
            </svg>
            <a href="tel:01120440740">01120440740</a>
        </div>
    </div>
</div>

<div class="container">
    <h1>ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</h1>
    <p class="subtitle">Ø¯Ø¹Ù… Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªØ¹Ø¯Ø¯Ø© + Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ù…ØªØ²Ø§Ù…Ù† Ù…Ø¹ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ù„Ù€6Ù… + Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>

    <h3 class="section-title">ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬</h3>
    <div class="form-grid">
        <div class="form-group">
            <label for="numOpenings">Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø©):</label>
            <input type="number" id="numOpenings" value="4" min="1" />
        </div>
        <div class="form-group">
            <label for="rodWeight">ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ù„Ù€ 6 Ù…ØªØ±/6.5 Ù…ØªØ± (ÙƒØ¬Ù…):</label>
            <input type="number" id="rodWeight" value="1.2" step="0.01" />
            <div class="small">Ø¥Ø°Ø§ Ù„Ø¯ÙŠÙƒ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø£Ø¯Ø®Ù„Ù‡ Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ³ÙŠÙØ­Ø¯Ù‘Ø« Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
        </div>
        <div class="form-group">
            <label for="weightPerMeter">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</label>
            <input type="number" id="weightPerMeter" value="0.200" step="0.001" />
            <div class="small">Ù…Ø«Ù„Ø§Ù‹: Ø¥Ø°Ø§ ÙˆØ²Ù†Ø© 1 Ù… ÙŠØ³Ø§ÙˆÙŠ 0.2 ÙƒØ¬Ù… ÙÙ€ 6 Ù… = 1.2 ÙƒØ¬Ù…</div>
        </div>
        <div class="form-group">
            <label for="numCuts">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</label>
            <input type="number" id="numCuts" value="8" min="1" />
            <div class="small">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨</div>
        </div>
        <div class="form-group">
            <label for="rodLength">Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯ (Ù…ØªØ±):</label>
            <select id="rodLength">
                <option value="6">6 Ù…ØªØ±</option>
                <option value="6.5">6.5 Ù…ØªØ±</option>
            </select>
            <div class="small">Ø§Ø®ØªØ± Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</div>
        </div>
        <div class="form-group">
            <label for="billetDiameter">Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù„Ù…ÙƒØ¨Ø³ (Ø¨ÙˆØµØ©):</label>
            <select id="billetDiameter">
                <option value="5">5 Ø¨ÙˆØµØ©</option>
                <option value="6">6 Ø¨ÙˆØµØ©</option>
                <option value="7" selected>7 Ø¨ÙˆØµØ©</option>
                <option value="8">8 Ø¨ÙˆØµØ©</option>
                <option value="9">9 Ø¨ÙˆØµØ©</option>
                <option value="10">10 Ø¨ÙˆØµØ©</option>
            </select>
        </div>
        <div class="form-group">
            <label for="moldNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ù…Ø«Ø§Ù„: 6621):</label>
            <input type="text" id="moldNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨" />
            <div class="small">Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†Ø³Ø®Ø©</div>
        </div>
        <div class="form-group">
            <label for="moldVersion">Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© (Ù…Ø«Ø§Ù„: 1 Ø£Ùˆ 2):</label>
            <input type="text" id="moldVersion" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©" />
        </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
    <div id="autoFillNotice" class="auto-fill-notice">
        <span class="auto-fill-indicator"></span>
        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
    <div class="mold-management">
        <h3 class="section-title">ğŸ’¾ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</h3>
        <div class="mold-buttons">
            <button class="mold-btn mold-save" onclick="saveMoldData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨</button>
            <button class="mold-btn mold-search" onclick="searchMold()">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨</button>
            <button class="mold-btn mold-show" onclick="showAllMolds()">ğŸ“‹ Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</button>
            <button class="mold-btn mold-delete" onclick="deleteMold()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨</button>
        </div>
        <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ø«Ù„ 6621/1 Ø£Ùˆ 6621/2 - Ø³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
    </div>

    <h3 class="section-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚</h3>
    <div class="form-grid">
        <div class="form-group">
            <label for="alloy">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨ÙŠÙƒØ©:</label>
            <select id="alloy" title="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø³ÙŠØ¹Ø¯Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ù‚Ù„ÙŠÙ„Ø§Ù‹">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø³Ø¨Ø§Ø¦Ùƒ Ù…ÙˆØ³Ø¹Ø© (ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ù†Ø§) -->
                <option value="1050">1050</option>
                <option value="1070">1070</option>
                <option value="1100">1100</option>
                <option value="3003">3003</option>
                <option value="3004">3004</option>
                <option value="2024">2024</option>
                <option value="6060">6060</option>
                <option value="6063" selected>6063 (Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø¨Ø«Ù‚)</option>
                <option value="6061">6061</option>
                <option value="6005">6005</option>
                <option value="6082">6082</option>
                <option value="7075">7075</option>
                <option value="5083">5083</option>
            </select>
            <div class="small">Ø¥Ø°Ø§ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ø®ØªØ± Ø§Ù„Ø£Ù‚Ø±Ø¨ Ø£Ùˆ Ø§Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ÙŠØ¯ÙˆÙŠÙ‹Ø§.</div>
        </div>

        <div class="form-group">
            <label for="weightPerCm">ÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù… (ÙƒØ¬Ù…):</label>
            <input type="number" id="weightPerCm" value="0.670" step="0.001" />
            <div class="small">Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø·Ø±ØŒ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹.</div>
        </div>

        <div class="form-group">
            <label for="extrusionRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="number" id="extrusionRatio" value="30" step="1" />
        </div>

        <div class="form-group">
            <label for="scrapPercentage">Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (%):</label>
            <input type="number" id="scrapPercentage" value="5" step="0.1" />
        </div>

        <div class="form-group">
            <label for="safetyFactor">Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (%):</label>
            <input type="number" id="safetyFactor" value="10" step="0.1" />
            <div class="small">Ø§ÙØªØ±Ø§Ø¶ÙŠ 10%Ø› Ù‚Ù„Ù‘Ù„Ù‡ Ù„Ù„Ù€5% Ù„Ùˆ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø«Ø§Ø¨ØªØ© ÙˆØ¯Ù‚ÙŠÙ‚Ø©.</div>
        </div>

        <div class="form-group">
            <label for="bedScrapLength">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ù…ØªØ±):</label>
            <input type="number" id="bedScrapLength" value="1.5" step="0.1" />
            <div class="small">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 1.5 Ù…ØªØ±)</div>
        </div>

        <div class="form-group">
            <label for="desiredTons">ÙƒÙ… Ø·Ù† ØªØ±ÙŠØ¯Ù‡ (Ø·Ù†) â€” Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙˆØ§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
            <input type="number" id="desiredTons" value="" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2.5" />
            <div class="small">Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø¥Ù† Ù„Ù… ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø·Ù†</div>
        </div>
    </div>

    <div class="buttons-group">
        <button class="calculate-btn" onclick="calculateBilletLength()">ğŸ§® Ø§Ø­Ø³Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª & Ø§Ù„Ù…Ù„Ø®Øµ</button>
        <button class="reset-btn" onclick="resetForm()">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        <button class="print-btn" onclick="printReport()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>

    <div id="result" class="result" aria-live="polite">
        <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        <div class="calculation-info">
            <p><strong>ğŸ”§ Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨:</strong> <span id="resultOpenings"></span></p>
            <p><strong>âš–ï¸ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ù„Ù€ 6 Ù…ØªØ±:</strong> <span id="resultRodWeight"></span> ÙƒØ¬Ù…</p>
            <p><strong>âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</strong> <span id="resultWeightPerMeter"></span></p>
            <p><strong>âœ‚ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</strong> <span id="resultCuts"></span></p>
            <p><strong>ğŸ“ Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯:</strong> <span id="resultRodLength"></span></p>
            <p><strong>ğŸ“ Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª:</strong> <span id="resultDiameter"></span></p>
            <p><strong>ğŸ”© Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong> <span id="resultAlloy"></span></p>
        </div>

        <div class="billet-result">
            ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetLength"></span> Ø³Ù…
        </div>

        <div style="color:#7f8c8d;font-size:15px;margin-top:8px;">
            âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetWeight"></span> ÙƒØ¬Ù…
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ -->
        <div id="bedLengthResult" class="bed-length-result" style="display:none;">
            <div class="bed-length-title">ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</div>
            <div class="bed-length-value" id="bedLengthValue"></div>
            <div class="bed-length-details" id="bedLengthDetails"></div>
        </div>

        <div id="calculationDetails" class="calculation-steps"></div>

        <div id="analysisBlock" class="analysis-table" style="display:none;">
            <table>
                <thead>
                    <tr><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</th><th>Ø§Ù„Ù†Ø§ØªØ¬</th></tr>
                </thead>
                <tbody id="analysisTableBody"></tbody>
            </table>
        </div>

        <div id="summaryBox" class="summary"></div>

        <!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
        <div class="whatsapp-row">
            <a class="whatsapp-btn" href="https://wa.me/201124006047" target="_blank" rel="noopener noreferrer" title="Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§ØªØ³Ø§Ø¨ SVG -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M20.52 3.478A11.79 11.79 0 0012 0C5.373 0 .01 5.373.01 12c0 2.12.56 4.17 1.62 5.97L0 24l6.24-1.62A11.93 11.93 0 0012 24c6.627 0 12-5.373 12-12 0-2.99-1.17-5.78-3.48-7.522z" fill="#25D366"/>
                    <path d="M17.4 14.1c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15s-.77.97-.95 1.17c-.17.2-.34.22-.64.07-1.71-.85-2.83-1.5-3.96-3.42-.3-.52.3-.49.86-1.62.09-.17.05-.31-.02-.46-.07-.15-.67-1.62-.92-2.22-.24-.58-.48-.5-.66-.51l-.56-.01c-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.27 0 1.34.98 2.63 1.12 2.81.14.17 1.93 3.12 4.68 4.37 1.63.7 2.37.75 3.22.63.49-.07 1.5-.61 1.71-1.21.21-.6.21-1.11.15-1.22-.06-.1-.22-.15-.52-.3z" fill="#fff"/>
                </svg>
                ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨: 01124006047
            </a>
        </div>
        <div class="whatsapp-note">Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ù‚Ù… (01124006047)</div>
    </div>
</div>

<script>
/* ----- Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ----- */
/* Ø£ÙˆØ²Ø§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ù‚Ø·Ø± (ÙƒØ¬Ù… Ù„ÙƒÙ„ Ø³Ù… ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø±) */
const baseBilletWeights = { '5':0.342,'6':0.492,'7':0.670,'8':0.875,'9':1.107,'10':1.367 };

/* Ø¹ÙˆØ§Ù…Ù„ ØªØµØ­ÙŠØ­ Ù„ÙƒÙ„ Ø³Ø¨ÙŠÙƒØ© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„ÙˆØ²Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (ØªØ¬Ø±ÙŠØ¨ÙŠ/ØªÙ‚Ø±ÙŠØ¨ÙŠ) */
/* ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 6060 Ùˆ1100 Ùˆ3004 Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ù…ØµØ± */
const alloyFactor = {
    '1050':0.98,
    '1070':0.99,
    '1100':0.96,
    '3003':1.00,
    '3004':1.00,
    '2024':1.01,
    '6060':1.00,
    '6063':1.00,
    '6061':0.995,
    '6005':1.01,
    '6082':1.02,
    '7075':1.03,
    '5083':1.02
};

/* ----- Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ----- */

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨
function autoSearchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) {
        return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒØªÙ…Ù„ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù†Ø³Ø®Ø©
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.getElementById('autoFillNotice').style.display = 'block';
    
    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø­Ø« (ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡ ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬)
    setTimeout(() => {
        try {
            const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
            const moldKey = `${moldNumber}/${moldVersion}`;
            const foundMold = moldDatabase[moldKey];
            
            if (foundMold) {
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('rodWeight').value = foundMold.rodWeight;
                document.getElementById('weightPerMeter').value = foundMold.weightPerMeter;
                document.getElementById('numOpenings').value = foundMold.numOpenings;
                document.getElementById('numCuts').value = foundMold.numCuts; // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª
                document.getElementById('alloy').value = foundMold.alloy;
                if (foundMold.rodLength) {
                    document.getElementById('rodLength').value = foundMold.rodLength;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                updateMeterFromRod();
                applyAlloyToWeight();
                
                // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                document.getElementById('autoFillNotice').style.display = 'none';
                
                // Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                calculateBilletLength();
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`, 'success');
                
            } else {
                // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨
                document.getElementById('autoFillNotice').style.display = 'none';
            }
            
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', e);
            document.getElementById('autoFillNotice').style.display = 'none';
        }
    }, 800); // ØªØ£Ø®ÙŠØ± 800 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø­Ø«
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¤Ù‚ØªØ©
function showTempMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: opacity 0.3s;
        ${type === 'success' ? 'background: #27ae60;' : 'background: #3498db;'}
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(messageDiv);
        }, 300);
    }, 3000);
}

// Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨
function saveMoldData() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    const rodWeight = document.getElementById('rodWeight').value;
    const weightPerMeter = document.getElementById('weightPerMeter').value;
    const numOpenings = document.getElementById('numOpenings').value;
    const numCuts = document.getElementById('numCuts').value; // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª
    const rodLength = document.getElementById('rodLength').value; // Ø¥Ø¶Ø§ÙØ© Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯
    const alloy = document.getElementById('alloy').value;
    
    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    const moldData = {
        rodWeight: rodWeight,
        weightPerMeter: weightPerMeter,
        numOpenings: numOpenings,
        numCuts: numCuts, // Ø­ÙØ¸ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª
        rodLength: rodLength, // Ø­ÙØ¸ Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯
        alloy: alloy,
        timestamp: new Date().toLocaleString('ar-EG'),
        moldNumber: moldNumber,
        moldVersion: moldVersion
    };
    
    try {
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const existingData = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        existingData[moldKey] = moldData;
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('moldDatabase', JSON.stringify(existingData));
        
        showTempMessage(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­\nÙŠØ´Ù…Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª: ${numCuts} ÙˆØ·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯: ${rodLength}Ù…`, 'success');
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        localStorage.setItem('lastUpdatedMold', moldKey);
        
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        console.error(e);
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨
function searchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    try {
        const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        let foundMold = null;
        let foundKey = '';
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨
        if (moldVersion) {
            // Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… ÙƒØ§Ù…Ù„ (6621/1)
            const fullKey = `${moldNumber}/${moldVersion}`;
            foundMold = moldDatabase[fullKey];
            foundKey = fullKey;
        } else {
            // Ø¨Ø­Ø« Ø¨Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… (Ø¬Ù…ÙŠØ¹ Ù†Ø³Ø® Ø§Ù„Ù‚Ø§Ù„Ø¨ 6621)
            const searchPattern = new RegExp(`^${moldNumber}/`);
            for (const key in moldDatabase) {
                if (searchPattern.test(key)) {
                    foundMold = moldDatabase[key];
                    foundKey = key;
                    break; // Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                }
            }
        }
        
        if (foundMold) {
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('rodWeight').value = foundMold.rodWeight;
            document.getElementById('weightPerMeter').value = foundMold.weightPerMeter;
            document.getElementById('numOpenings').value = foundMold.numOpenings;
            document.getElementById('numCuts').value = foundMold.numCuts; // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª
            document.getElementById('alloy').value = foundMold.alloy;
            if (foundMold.rodLength) {
                document.getElementById('rodLength').value = foundMold.rodLength;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
            updateMeterFromRod();
            applyAlloyToWeight();
            
            // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨
            document.getElementById('moldNumber').value = foundMold.moldNumber;
            document.getElementById('moldVersion').value = foundMold.moldVersion;
            
            // Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            calculateBilletLength();
            
            showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${foundKey}\nØ¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª: ${foundMold.numCuts} - Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯: ${foundMold.rodLength || '6'}Ù…`, 'success');
        } else {
            alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«');
        console.error(e);
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
function showAllMolds() {
    try {
        const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        const moldKeys = Object.keys(moldDatabase);
        
        if (moldKeys.length === 0) {
            alert('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯');
            return;
        }
        
        let message = `ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (${moldKeys.length}):\n\n`;
        moldKeys.forEach(key => {
            const mold = moldDatabase[key];
            message += `ğŸ”¸ ${key} - Ø§Ù„ÙˆØ²Ù†: ${mold.rodWeight} ÙƒØ¬Ù… - Ø§Ù„ÙØªØ­Ø§Øª: ${mold.numOpenings} - Ø§Ù„Ù‚ØµØ§Øª: ${mold.numCuts}\n`;
            message += `   Ø§Ù„Ø³Ø¨ÙŠÙƒØ©: ${mold.alloy} - Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯: ${mold.rodLength || '6'}Ù… - Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${mold.timestamp}\n\n`;
        });
        
        alert(message);
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ù‚Ø§Ù„Ø¨
function deleteMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ù„Ù„Ø­Ø°Ù');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey}ØŸ`)) {
        try {
            const moldDatabase = JSON.parse(localStorage.getItem('moldDatabase') || '{}');
            
            if (moldDatabase[moldKey]) {
                delete moldDatabase[moldKey];
                localStorage.setItem('moldDatabase', JSON.stringify(moldDatabase));
                showTempMessage(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
                // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('moldNumber').value = '';
                document.getElementById('moldVersion').value = '';
            } else {
                alert('âŒ Ø§Ù„Ù‚Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            }
        } catch (e) {
            alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
        }
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´
function calculateBedLength() {
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = parseFloat(document.getElementById('rodLength').value) || 6;
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    
    if (numCuts <= 0) return null;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ØµØ§ÙÙŠ
    const netLength = numCuts * rodLength;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ Ù…Ø¹ Ø§Ù„Ù‡Ø§Ù„Ùƒ
    const totalLength = netLength + bedScrapLength;
    
    return {
        netLength: netLength,
        totalLength: totalLength,
        rodLength: rodLength,
        bedScrapLength: bedScrapLength,
        numCuts: numCuts
    };
}

/* Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ */
function saveState() {
    const state = {
        numOpenings: document.getElementById('numOpenings').value,
        rodWeight: document.getElementById('rodWeight').value,
        weightPerMeter: document.getElementById('weightPerMeter').value,
        numCuts: document.getElementById('numCuts').value,
        rodLength: document.getElementById('rodLength').value,
        billetDiameter: document.getElementById('billetDiameter').value,
        alloy: document.getElementById('alloy').value,
        weightPerCm: document.getElementById('weightPerCm').value,
        extrusionRatio: document.getElementById('extrusionRatio').value,
        scrapPercentage: document.getElementById('scrapPercentage').value,
        safetyFactor: document.getElementById('safetyFactor').value,
        bedScrapLength: document.getElementById('bedScrapLength').value,
        desiredTons: document.getElementById('desiredTons').value,
        moldNumber: document.getElementById('moldNumber').value,
        moldVersion: document.getElementById('moldVersion').value
    };
    try { localStorage.setItem('billetCalculatorState', JSON.stringify(state)); } catch(e){}
}

function loadState() {
    try {
        const s = JSON.parse(localStorage.getItem('billetCalculatorState') || '{}');
        if (s.numOpenings) document.getElementById('numOpenings').value = s.numOpenings;
        if (s.rodWeight) document.getElementById('rodWeight').value = s.rodWeight;
        if (s.weightPerMeter) document.getElementById('weightPerMeter').value = s.weightPerMeter;
        if (s.numCuts) document.getElementById('numCuts').value = s.numCuts;
        if (s.rodLength) document.getElementById('rodLength').value = s.rodLength;
        if (s.billetDiameter) document.getElementById('billetDiameter').value = s.billetDiameter;
        if (s.alloy) document.getElementById('alloy').value = s.alloy;
        if (s.weightPerCm) document.getElementById('weightPerCm').value = s.weightPerCm;
        if (s.extrusionRatio) document.getElementById('extrusionRatio').value = s.extrusionRatio;
        if (s.scrapPercentage) document.getElementById('scrapPercentage').value = s.scrapPercentage;
        if (s.safetyFactor) document.getElementById('safetyFactor').value = s.safetyFactor;
        if (s.bedScrapLength) document.getElementById('bedScrapLength').value = s.bedScrapLength;
        if (s.desiredTons) document.getElementById('desiredTons').value = s.desiredTons;
        if (s.moldNumber) document.getElementById('moldNumber').value = s.moldNumber;
        if (s.moldVersion) document.getElementById('moldVersion').value = s.moldVersion;
    } catch(e){}
}

/* ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø·Ø± Ø£Ùˆ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© */
document.getElementById('billetDiameter').addEventListener('change', function(){ applyAlloyToWeight(); saveState(); });
document.getElementById('alloy').addEventListener('change', function(){ applyAlloyToWeight(); saveState(); });

/* ØªØ²Ø§Ù…Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ÙˆÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ */
const rodWeightInput = document.getElementById('rodWeight');
const weightPerMeterInput = document.getElementById('weightPerMeter');

function updateRodFromMeter() {
    const m = parseFloat(weightPerMeterInput.value);
    if (!isNaN(m)) {
        rodWeightInput.value = (m * 6).toFixed(3);
    }
}
function updateMeterFromRod() {
    const r = parseFloat(rodWeightInput.value);
    if (!isNaN(r)) {
        weightPerMeterInput.value = (r / 6).toFixed(3);
    }
}
weightPerMeterInput.addEventListener('input', () => { updateRodFromMeter(); saveState(); });
rodWeightInput.addEventListener('input', () => { updateMeterFromRod(); saveState(); });

function applyAlloyToWeight(){
    const diam = document.getElementById('billetDiameter').value;
    const alloy = document.getElementById('alloy').value;
    const base = baseBilletWeights[diam] || 0.67;
    const factor = alloyFactor[alloy] || 1.0;
    const newVal = (base * factor).toFixed(3);
    document.getElementById('weightPerCm').value = parseFloat(newVal);
}

/* Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ */
document.getElementById('moldNumber').addEventListener('input', function() {
    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©
    if (document.getElementById('moldVersion').value.trim()) {
        setTimeout(autoSearchMold, 500);
    }
});

document.getElementById('moldVersion').addEventListener('input', function() {
    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨
    if (document.getElementById('moldNumber').value.trim()) {
        setTimeout(autoSearchMold, 500);
    }
});

/* Ø­ÙØ¸ Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ± Ù„Ù„Ø­Ù‚Ù„ (Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª) */
const watched = document.querySelectorAll('input, select');
watched.forEach(el => el.addEventListener('change', saveState));

/* Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
function calculateBilletLength(){
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 0;
    const rodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = parseFloat(document.getElementById('rodLength').value) || 6;
    const billetDiameter = document.getElementById('billetDiameter').value;
    const alloy = document.getElementById('alloy').value;
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const extrusionRatio = parseFloat(document.getElementById('extrusionRatio').value) || 0;
    const scrapPercentage = parseFloat(document.getElementById('scrapPercentage').value) || 0;
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 0;
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    const desiredTons = parseFloat(document.getElementById('desiredTons').value);

    if (!numOpenings || !rodWeight || !numCuts || !weightPerCm) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ÙØªØ­Ø§ØªØŒ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (Ø£Ùˆ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ)ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§ØªØŒ ÙˆÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù…');
        return;
    }

    const totalRodsCount = numOpenings * numCuts;
    const totalRodsWeight = rodWeight * totalRodsCount;
    const scrapFactor = 1 + (scrapPercentage / 100);
    const safetyFactorValue = 1 + (safetyFactor / 100);
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´
    const bedScrapWeight = (bedScrapLength * weightPerMeter * numOpenings);
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´
    const finalWeight = (totalRodsWeight * scrapFactor * safetyFactorValue) + bedScrapWeight;
    
    const billetLengthCm = finalWeight / weightPerCm;
    const billetWeightKg = billetLengthCm * weightPerCm;

    document.getElementById('resultOpenings').textContent = numOpenings;
    document.getElementById('resultRodWeight').textContent = rodWeight.toFixed(3);
    document.getElementById('resultWeightPerMeter').textContent = weightPerMeter.toFixed(3);
    document.getElementById('resultCuts').textContent = numCuts;
    document.getElementById('resultRodLength').textContent = rodLength + ' Ù…ØªØ±';
    document.getElementById('resultDiameter').textContent = billetDiameter + ' Ø¨ÙˆØµØ©';
    document.getElementById('resultAlloy').textContent = alloy;

    document.getElementById('billetLength').textContent = isFinite(billetLengthCm) ? billetLengthCm.toFixed(1) : '0.0';
    document.getElementById('billetWeight').textContent = isFinite(billetWeightKg) ? billetWeightKg.toFixed(1) : '0.0';

    // Ø­Ø³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´
    const bedLengthData = calculateBedLength();
    if (bedLengthData) {
        document.getElementById('bedLengthValue').textContent = `${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±`;
        document.getElementById('bedLengthDetails').innerHTML = `
            <div class="bed-length-step"><strong>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ØµØ§ÙÙŠ:</strong> ${bedLengthData.numCuts} Ù‚ØµÙ‘Ø© Ã— ${bedLengthData.rodLength} Ù…ØªØ± = ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong> ${bedLengthData.bedScrapLength} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</strong> ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ± + ${bedLengthData.bedScrapLength} Ù…ØªØ± = ${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±</div>
        `;
        document.getElementById('bedLengthResult').style.display = 'block';
    } else {
        document.getElementById('bedLengthResult').style.display = 'none';
    }

    document.getElementById('calculationDetails').innerHTML = `
        <h4>ğŸ§® Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</h4>
        <div class="step"><strong>1. Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ:</strong><br>${numOpenings} ÙØªØ­Ø© Ã— ${numCuts} Ù‚ØµÙ‘Ø© = ${totalRodsCount} Ø¹ÙˆØ¯</div>
        <div class="step"><strong>2. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong><br>${rodWeight.toFixed(3)} ÙƒØ¬Ù…/Ø¹ÙˆØ¯ Ã— ${totalRodsCount} = ${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>3. Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%):</strong><br>${totalRodsWeight.toFixed(3)} Ã— ${scrapFactor.toFixed(3)} = ${(totalRodsWeight*scrapFactor).toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>4. Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%):</strong><br>${(totalRodsWeight*scrapFactor).toFixed(3)} Ã— ${safetyFactorValue.toFixed(3)} = ${(totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>5. Ø§Ø­ØªØ³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong><br>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings} ÙØªØ­Ø© = ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>6. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong><br>${(totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3)} ÙƒØ¬Ù… + ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù… = ${finalWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>7. Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª:</strong><br>${finalWeight.toFixed(3)} ÙƒØ¬Ù… Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù… = ${billetLengthCm.toFixed(1)} Ø³Ù…</div>
        <div style="background:#d4edda;padding:12px;border-radius:6px;margin-top:12px;">
            <strong>ğŸ“ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong><br>
            Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª (Ø³Ù…) = [ (ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµÙ‘Ø§Øª Ã— Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª) Ã— (1 + Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ) Ã— (1 + Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù†) + (Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ Ã— Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ã— Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª) ] Ã· (ÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ø¨Ù€ ÙƒØ¬Ù…/Ø³Ù…)
        </div>
    `;

    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const analysisBody = document.getElementById('analysisTableBody');
    analysisBody.innerHTML = '';
    const tr1 = `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØµØ§ÙÙŠ</td><td>ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµÙ‘Ø§Øª Ã— Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª</td><td>${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`;
    const weightAfterScrap = (totalRodsWeight * scrapFactor);
    const tr2 = `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%)</td><td>Ã— (1 + ${scrapPercentage/100})</td><td>${weightAfterScrap.toFixed(3)} ÙƒØ¬Ù…</td></tr>`;
    const weightAfterSafety = (weightAfterScrap * safetyFactorValue);
    const tr3 = `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%)</td><td>Ã— (1 + ${safetyFactor/100})</td><td>${weightAfterSafety.toFixed(3)} ÙƒØ¬Ù…</td></tr>`;
    const tr4 = `<tr><td>ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</td><td>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings}</td><td>${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`;
    const tr5 = `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>${weightAfterSafety.toFixed(3)} + ${bedScrapWeight.toFixed(3)}</td><td class="highlight">${finalWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`;
    const tr6 = `<tr><td>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù…</td><td class="highlight">${billetLengthCm.toFixed(1)} Ø³Ù…</td></tr>`;
    analysisBody.innerHTML = tr1 + tr2 + tr3 + tr4 + tr5 + tr6;
    document.getElementById('analysisBlock').style.display = 'block';

    // Ø®Ø§Ù†Ø© Ø·Ù†
    let summaryHtml = '';
    if (!isNaN(desiredTons) && desiredTons > 0) {
        const desiredKg = desiredTons * 1000;
        const billetsNeeded = Math.ceil(desiredKg / billetWeightKg);
        const rodsProduced = billetsNeeded * totalRodsCount;
        const producedKg = billetsNeeded * billetWeightKg;
        const diffKg = producedKg - desiredKg;

        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ù„Ø·Ù„Ø¨ ${desiredTons} Ø·Ù† (Ø£ÙŠ ${desiredKg.toLocaleString()} ÙƒØ¬Ù…):</strong><br>`;
        summaryHtml += `â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <strong>${billetsNeeded.toLocaleString()}</strong> Ø¨Ù„ÙŠØª<br>`;
        summaryHtml += `â€¢ ÙƒÙ„ Ø¨Ù„ÙŠØª ÙŠØ²Ù† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§: <strong>${billetWeightKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„Ù†Ø§ØªØ¬Ø©: <strong>${rodsProduced.toLocaleString()}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ù†Ø§ØªØ¬ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ù„ÙŠØª: <strong>${producedKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <strong>${diffKg >= 0 ? '+' : ''}${diffKg.toFixed(1)} ÙƒØ¬Ù…</strong> (${(diffKg/1000).toFixed(3)} Ø·Ù†)`;
    } else {
        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø²Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø²Ù…Ø©: <strong>${totalRodsCount}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ ÙˆØ²Ù† Ø§Ù„Ø­Ø²Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù†: <strong>${finalWeight.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ù…Ù‚ØªØ±Ø­: <strong>${billetLengthCm.toFixed(1)} Ø³Ù…</strong><br>`;
    }
    document.getElementById('summaryBox').innerHTML = summaryHtml;

    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });

    saveState();
}

/* Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± */
function printReport(){
    const header = `<h2 style="text-align:center">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù„ÙŠØª</h2><p style="text-align:center">Ù…Ù‚Ø¯Ù…Ø© Ø¥Ù„ÙŠÙƒÙ… Ù…Ù† ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</p><hr/>`;
    const content = document.getElementById('result').innerHTML;
    const newWindow = window.open('','_blank','width=900,height=700');
    newWindow.document.write(`<html><head><title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¨Ù„ÙŠØª</title></head><body>${header}${content}</body></html>`);
    newWindow.document.close();
    newWindow.focus();
    setTimeout(()=>{ newWindow.print(); },300);
}

/* Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· */
function resetForm(){
    document.getElementById('numOpenings').value = '4';
    document.getElementById('rodWeight').value = '1.2';
    document.getElementById('weightPerMeter').value = (1.2/6).toFixed(3);
    document.getElementById('numCuts').value = '8';
    document.getElementById('rodLength').value = '6';
    document.getElementById('billetDiameter').value = '7';
    document.getElementById('alloy').value = '6063';
    document.getElementById('weightPerCm').value = baseBilletWeights['7'];
    document.getElementById('extrusionRatio').value = '30';
    document.getElementById('scrapPercentage').value = '5';
    document.getElementById('safetyFactor').value = '10';
    document.getElementById('bedScrapLength').value = '1.5';
    document.getElementById('desiredTons').value = '';
    document.getElementById('moldNumber').value = '';
    document.getElementById('moldVersion').value = '';
    document.getElementById('result').style.display = 'none';
    document.getElementById('calculationDetails').innerHTML = '';
    document.getElementById('summaryBox').innerHTML = '';
    document.getElementById('analysisBlock').style.display = 'none';
    document.getElementById('bedLengthResult').style.display = 'none';
    document.getElementById('autoFillNotice').style.display = 'none';
    saveState();
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ */
loadState();
applyAlloyToWeight();
updateMeterFromRod();

// Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ù‚Ø§Ù„Ø¨ ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„ÙŠÙ‡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', function() {
    const lastMold = localStorage.getItem('lastUpdatedMold');
    if (lastMold) {
        console.log(`Ø¢Ø®Ø± Ù‚Ø§Ù„Ø¨ ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ${lastMold}`);
    }
});

// ========== PWA INSTALLATION CODE ==========
let deferredPrompt;
const installButton = document.getElementById('installButton');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installButton.style.display = 'block';
});

installButton.addEventListener('click', async () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            installButton.style.display = 'none';
            console.log('âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        }
        deferredPrompt = null;
    }
});

window.addEventListener('appinstalled', () => {
    installButton.style.display = 'none';
    deferredPrompt = null;
    console.log('ğŸ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²');
});

// Service Worker Ù„Ù„ØªØ«Ø¨ÙŠØª
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                console.log('âœ… ServiceWorker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:', registration.scope);
            })
            .catch(function(err) {
                console.log('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ ServiceWorker:', err);
            });
    });
}
</script>
</body>
</html>
